{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block head %}

<link type="text/css" rel="stylesheet" href="{% static 'css/terminal.css' %}" />
<link type="text/css" rel="stylesheet" href="{% static 'css/products.css' %}" />
<link type="text/css" rel="stylesheet" href="{% static 'css/categories.css' %}" />
<link type="text/css" rel="stylesheet" href="{% static 'css/bill.css' %}" />

{% comment %} the terminal {% endcomment %}
<script src="{% static 'widgets/terminal.js' %}"></script>
{% comment %} widgets {% endcomment %}
<script src="{% static 'widgets/categories.js' %}"></script> {% comment %} categories selector {% endcomment %}
<script src="{% static 'widgets/products.js' %}"></script> {% comment %} products selector {% endcomment %}
<script src="{% static 'widgets/search.js' %}"></script> {% comment %} bill and its items {% endcomment %}
<script src="{% static 'widgets/bill.js' %}"></script> {% comment %} bill and its items {% endcomment %}

{% comment %} other {% endcomment %}
<script src="{% static 'fuckyeah/fuckyeah.jquery.js' %}"></script>


{% comment %} 'embedded' javascript {% endcomment %}
<script type="text/javascript">
$(document).ready(function(){
    // global data and objects
    var g = { // global data for the terminal
        csrf_token: "{{ csrf_token }}",
        urls: {
              // terminal & stuff
              save_terminal_settings: "{% url 'pos:save_terminal' company.url_name  %}",

              // bill and items
              create_bill: "{% url 'pos:create_bill' company.url_name %}"
        },

        // config (data comes directly from view)
        config: {% autoescape off %}{{ config }}{% endautoescape %},

        // other data (directly from view)
        // includes: categories,
        data: {% autoescape off %}{{ data }}{% endautoescape %},

        // javascript objects (initialized later)
        objects:{
            terminal: null, // everything related to terminal, windows, controls etc
            categories: null,
            products: null,
            search: null,
            bill: null // current bill (will be loaded with ajax)
        },

        // static ui settings
        settings: {
            t: 100, // duration of show/hide events
            t_easing: 200, // duration of easing functions (drag start/stop)
            last_search: "", // last searched query
            search_update_interval: 1000 // checking if search query has changed
        },

        // cached jquery items
        items: {
            focused: null, // will be assigned a jquery element as soon as a key is pressed/mouse clicked

            // items that are ready to be inserted
            spacer: $("<img>", {src:"{% static 'graphics/spacer.png' %}"}),
            loading_animation: $("<img>", {src: "{% static 'graphics/loading.gif' %}"}),
            subcategory: $("<img>", {src:"{% static 'graphics/subcategory.png' %}"})
        }
    };

    // object initialization
    g.objects.terminal = new Terminal(g);
    g.objects.categories = new Categories(g); // categories selector (level 0 is the topmost category)
    g.objects.products = new Products(g);
    g.objects.search = new Search(g);
    g.objects.bill = new Bill(g);


});
</script>

{% endblock %}

{% block content %}
{% comment %} the 'loading' div {% endcomment %}
{% comment %} management, logout, ... links {% endcomment %}
<div id="manage_bar">
    <div id="blocklogic"><a href="http://www.blocklogic.net">BlockLogic</a></div>
    <div class="management-bar-button"><a href="{% url 'pos:manage_home' company.url_name %}">{% trans 'Manage' %}</a></div>
    <div class="management-bar-button"><a href="#">{% trans 'Logout' %}</a></div>
    <div id="messages">messages</div> {% comment %} actually in center, but with overflow:hidden {% endcomment %}
</div>

{% comment %} the bill (scrolling) {% endcomment %}
{% comment %} bill header has the same layout as items and will be copied when adding new (items) {% endcomment %}
<div id="bill_header" class="bill-item header">
    <div class="item-val name header">
        <p class="bill-title">{% trans 'Name' %}</p> {% comment %} product name and code {% endcomment %}
        <p class="bill-subtitle">{% trans 'Code' %}</p></div>
    <div class="item-val quantity header">
        <p class="bill-title">{% trans 'Qty' %}</p> {% comment %} quantity and unit type {% endcomment %}
        <p class="bill-subtitle">{% comment %} empty at the moment {% endcomment %}</p></div>
    <div class="item-val price header">
        <p class="bill-title">{% trans 'Price' %}</p> {% comment %} base price {% endcomment %}
        <p class="bill-subtitle">[{{ currency }}]   </p></div>
    <div class="item-val tax header">
        <p class="bill-title">{% trans 'Tax' %}</p>{% comment %} tax, percent and absolute value {% endcomment %}
        <p class="bill-subtitle">[%/{{ currency }}]</p></div>
    <div class="item-val discount header">
        <p class="bill-title">{% trans 'Discount' %}</p> {% comment %} discount, absolute value and a 'mode' button {% endcomment %}
        <p class="bill-subtitle">[{{ currency }}]</p></div>
    <div class="item-val total header">
        <p class="bill-title">{% trans 'Total' %}</p> {% comment %} total of this Item(s) {% endcomment %}
        <p class="bill-subtitle">[{{ currency }}]</p></div>

    <div class="item-val edit header">
        {% comment %} edit buttons for this row {%  endcomment %}
    </div>
</div>
<div id="bill_scroll_outer">
    <div id="bill_scroll_inner">
        <div id="bill">
            <div class="bill-item" id="bill_item_template">
                <div class="item-val name"> {# name and code #}
                    <div class="value item name"></div>
                    <div class="subvalue item code"></div>
                </div>
                <div class="item-val quantity"> {# quantity #}
                    <input type="button" class="qty-plus" value="+" />
                    <input type="text" class="qty" />
                    <input type="button" class="qty-minus" value="-" />
                </div>
                <div class="item-val price"> {# price #}
                    <div class="value item price"></div>
                </div>
                <div class="item-val tax"> {# tax #}
                    <div class="value item tax"></div>
                    <div class="subvalue item tax"></div>
                </div>
                <div class="item-val discount"> {# discount #}
                    <div class="value item discount"></div>
                    <input type="button" class="discount-more" value="..." />
                </div>
                <div class="item-val total"> {# total #}
                    <div class="value item total"></div> {% comment %} total of this Item(s) {% endcomment %}
                </div>
                <div class="item-val edit"> {# edit buttons #}
                    <input type="button" class="explode" value="e" />
                    <input type="button" class="delete" value="x" />
                </div>
            </div>
        </div>
    </div>
</div>
{% comment %} bill summary and till: fixed {% endcomment %}
<div id="till">
    {% comment %} bill summary: discounts total and tax total {% endcomment %}
    <div id="bill_summary">
        <div class="total">
            {% trans "Fakin total" %}:
            <p class="total">{# placeholder, this is #}</p>
        </div>
    </div>

    {% comment %} buttons etc. {% endcomment %}
    <div id="bill_actions">
        <button class="finish-the-fukin-bill">
            <span style="font-size: 30px; font-weight: bold; width: 100%;">
                FINISH THE FUKIN BILL
            </span>
        </button>
    </div>
</div>

{% comment %} separator: draggable div for resizing bill/controls {% endcomment %}
<div id="splitter"></div>

{% comment %} product selector and other controls {% endcomment %}
<div id="selector">
    <div id="categories">
        <div id="parents_scroll_outer">
            {% comment %} fixed buttons: favorites and 'home' {% endcomment %}
            <div class="category-button" id="category_button_favorites">
                <img class="category-button-icon" src="{% static 'graphics/favorites.png' %}" alt="{% trans 'Favorites' %}" />
                {% trans 'Favorites' %}
            </div>
            <div class="category-button" id="category_button_home"><img class="category-button-icon" src="{% static 'graphics/home.png' %}" alt="{% trans 'Home' %}" />
                {% trans 'All' %}
            </div>

            {% comment %} scrolling: parents {% endcomment %}
            <div id="parents_scroll_inner">
                <div id="parents"></div>
            </div>
        </div>
        
        {% comment %} scrolling: children {% endcomment %}
        <div id="children_scroll_outer">
            <div id="children_scroll_inner">
                <div id="children"></div>
            </div>
        </div>
    </div>
    <div id="products_scroll_outer">
        <div id="products_scroll_inner">
            <div id="products"></div>
        </div>
    </div>
    <div id="controls">
        <input type="text" id="search_products_filter" />
        <button type="button" id="search_products_submit"><img src="{% static 'graphics/search.png'%}"/></button>
    </div>
</div>

{% endblock %}
