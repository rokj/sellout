{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block head %}

<link type="text/css" rel="stylesheet" href="{% static 'css/terminal.css' %}" />
<link type="text/css" rel="stylesheet" href="{% static 'css/products.css' %}" />
<link type="text/css" rel="stylesheet" href="{% static 'css/categories.css' %}" />
<link type="text/css" rel="stylesheet" href="{% static 'css/bill.css' %}" />

<style type="text/css">
.item-val.quantity input[type='text']{
    background-image: url("{% static 'icons/quantity_background.png' %}");
    background-position: center center;
    background-repeat:  no-repeat;
}

.details-box button.remove-item-discount{
    background-image: url("{% static 'icons/delete_active.png' %}");
}

</style>

{# jquery libraries (only used in terminal) #}
<script src="{% static 'js/jquery.printThis.js' %}"></script>

{% comment %} the terminal {% endcomment %}
<script src="{% static 'js/widgets/terminal.js' %}"></script>
{% comment %} widgets {% endcomment %}
<script src="{% static 'js/widgets/categories.js' %}"></script> {% comment %} categories selector {% endcomment %}
<script src="{% static 'js/widgets/products.js' %}"></script> {% comment %} products selector {% endcomment %}
<script src="{% static 'js/widgets/search.js' %}"></script> {% comment %} searching products/categories {% endcomment %}
<script src="{% static 'js/widgets/bill.js' %}"></script> {% comment %} bill and its items {% endcomment %}
<script src="{% static 'js/widgets/print.js' %}"></script> {% comment %} formatting and printing receipts {% endcomment %}

{% comment %} 'embedded' javascript {% endcomment %}
<script type="text/javascript">
$(window).load(function(){
    // global data and objects
    var g = { // global data for the terminal
        csrf_token: "{{ csrf_token }}",
        urls: {
              // terminal & stuff
              save_terminal_settings: "{% url 'pos:save_terminal' company.url_name  %}",
              create_bill: "{% url 'pos:create_bill' company.url_name %}",
              // management: registers (a link is needed for choosing current register)
              manage_registers: "{% url 'pos:list_registers' company.url_name %}",
              // save last used register
              set_register: "{% url 'pos:set_register' company.url_name %}"
        },

        // config (data comes directly from view)
        config: {% autoescape off %}{{ config }}{% endautoescape %},

        // other data (directly from view)
        // includes: categories,
        data: {% autoescape off %}{{ data }}{% endautoescape %},

        // javascript objects (initialized later)
        objects:{
            terminal: null, // everything related to terminal, windows, controls etc
            categories: null,
            products: null,
            search: null,
            bill: null // current bill (will be loaded with ajax)
        },

        // static ui settings
        settings: {
            t: 100, // duration of show/hide events
            t_easing: 200, // duration of easing functions (drag start/stop)
            last_search: "", // last searched query
            search_update_interval: 1000 // checking if search query has changed
        },

        // cached jquery items
        items: {
            focused: null, // will be assigned a jquery element as soon as a key is pressed/mouse clicked

            // items that are ready to be inserted
            spacer: $("<img>", {src:"{% static 'graphics/spacer.png' %}"}),
            loading_animation: $("<img>", {src: "{% static 'graphics/loading.gif' %}"}),
            subcategory: $("<img>", {src:"{% static 'graphics/subcategory.png' %}"}),

            company_logo: null, // will be created when terminal initializes

            fullscreen_shadow: $("#fullscreen_shadow"),
           loading: $("#loading"),

            small_receipt_template: $("#small_receipt_template"),
            large_receipt_template: $()
        }
    };

    // object initialization
    g.objects.terminal = new Terminal(g);
    g.objects.categories = new Categories(g); // categories selector (level 0 is the topmost category)
    g.objects.products = new Products(g);
    g.objects.search = new Search(g);
    g.objects.bill = new Bill(g);

    // in the beginning, show favorites and topmost category
    g.objects.categories.favorites_button_action();

    // when everything is loaded, remove the loading screen and show the terminal
    setTimeout(function(){
            g.items.loading.fadeOut("fast", function(){
            g.items.loading.remove();
        });
    }, 500);

});
</script>

{% endblock %}

{% block content %}
    {% comment %} the loading screen {% endcomment %}
    <div id="loading">
        <div>
            <img src="{% static 'icons/loading.gif' %}" alt="loading" class="loading" />
            {% trans 'Loading' %}
        </div>
    </div>


    {% comment %} the bill (scrolling) {% endcomment %}
    <div id="left_column">
        <div>
            {% comment %} bill header has the same layout as items and will be copied when adding new item {% endcomment %}
            <div id="bill_header" class="bill-item header">
                <div class="bill-border-bottom contain-floats">
                    {% comment %} product name and code {% endcomment %}
                    <div class="item-val name header"> {% trans 'Name' %} </div>
                    {% comment %} quantity and unit type {% endcomment %}
                    <div class="item-val quantity header"> {% trans 'Qty' %} </div>
                    {% comment %} base price {% endcomment %}
                    <div class="item-val price header">{% trans 'Price' %}{# {{ currency }} #}</div>
                    {% comment %} tax, percent and absolute value {% endcomment %}
                    <div class="item-val tax header"> {% trans 'Tax' %} </div>
                    {% comment %} discount {% endcomment %}
                    <div class="item-val discount header"> {% trans 'Discount' %} </div>

                    {% comment %} total of this Item(s) {% endcomment %}
                    <div class="item-val total header">{% trans 'Total' %}</div>
                </div>
            </div>

            <div id="bill_container">
                <div id="bill">
                    <div class="bill-item collapsed" id="bill_item_template">
                        {# name #}
                        <div class="item-val name">
                            <img src="{% static 'icons/delete_active.png' %}"
                                 class="delete"
                                 alt="{% trans 'Remove' %}"
                                 title="{% trans 'Remove product from bill' %}" />

                            <div class="value item name"></div>

                            {# more button #}
                            <button class="more">{% trans 'More' context 'More button in bill item' %}</button>
                        </div>
                        {# quantity #}
                        <div class="item-val quantity">
                            {# wrap everything in another div so that everything will be centered #}
                            <div>
                                <button class="qty-plus">+</button>
                                <input type="text" class="qty" />
                                <button class="qty-minus">-</button>
                            </div>
                        </div>
                        {# price #}
                        <div class="item-val price">
                            <div class="value item price"></div>
                        </div>
                        {# tax #}
                        <div class="item-val tax">
                            <div class="value item tax"></div>
                        </div>
                        {# discount #}
                        <div class="item-val discount">
                            <div class="value item discount"></div>
                        </div>
                        {# sub-total #}
                        <div class="item-val total">
                            <div class="value item total"></div>
                        </div>
                    </div>
                </div>
            </div>

            {% comment %} bill summary and till: fixed {% endcomment %}
            <div id="till">
                {% comment %} bill summary: discounts total and tax total {% endcomment %}
                <div id="bill_summary">
                    <div class="total bill-border-top bill-border-bottom">
                        <p class="total">{# placeholder, this is #}-</p>
                        {% trans "Fakin total" %}:
                    </div>
                </div>

                {% comment %} buttons etc. {% endcomment %}
                <div id="bill_actions">
                    <button class="till-button" id="finish_the_fukin_bill">Finish</button>
                    <button class="till-button" id="save_the_fukin_bill">Save</button>
                </div>
            </div>
        </div>
    </div>

    {% comment %} separator: draggable div for resizing bill/controls {% endcomment %}
    <div id="splitter">
        <img src="{% static 'icons/grip_vertical.png' %}"
             alt="" title="{% trans 'Drag to resize bill' %}" />
    </div>

    {% comment %} product selector and other controls {% endcomment %}
    <div id="selector">
        <div id="categories">
            <div id="parents_scroll_outer">
                <div class="category-button" id="category_button_favorites">{% trans 'Favorites' %}</div>

                <div id="category_parent" class="category-button hidden">
                    <img src="{% static 'icons/back_black.png' %}"
                         alt="{% trans 'Back' %}"
                         title="{% trans 'Back' %}" />
                </div>
                {% comment %} scrolling: parents {% endcomment %}
                <div id="parents_scroll_inner">
                    <div id="parents"></div>
                </div>
            </div>

            <div class="selector-title">
                <div id="subcategories_title">{# text will be set by categories.js:set_texts #}</div>
            </div>

            {% comment %} scrolling: children {% endcomment %}
            <div id="children_scroll_outer">
                <div id="children_scroll_inner">
                    <div id="children"></div>
                </div>
            </div>
        </div>

        <div id="products_scroll_outer">
            <div class="selector-title absolute">
                <div id="products_title">{# text will be set by categories.js:set_texts #}</div>
            </div>
            <div id="products_scroll_inner">
                <div id="products"></div>
            </div>
        </div>
        <div id="controls">
            <div> {# for margins and position: absolute #}
                <div id="till_selector_container">
                    <div id="current_till"></div>
                </div>

                <div class="bill-border-top"></div>
                    <div id="search_container">
                    <input type="text" id="search_products_filter" placeholder="{% trans 'Search' %}" />
                    <button type="button" id="search_products_submit">
                        {% trans 'Go' context 'Search button text' %}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="registers" class="hidden">
        {% comment %} the dialog for selecting register on login {% endcomment %}
        {% trans 'Which register have you logged on?' %}
        <select id="registers_list">
            {% for r in  registers %}
                <option value="{{ r.id }}">{{ r.name }}</option>
            {% endfor %}
        </select>
        <input type="button" value="{% trans 'Go' %}" id="select_register"/>
    </div>

<div id="templates" class="hidden">
    <div id="small_receipt_template">
        {% include 'pos/small_receipt.html' %}
    </div>
    <div id="large_receipt_template">
        {% include 'pos/large_receipt.html' %}
    </div>

    <div class="details-box hidden" id="details_box_template">
        {# the arrow that should point to bill item #}
        <div class="item-arrow"></div>

        {# and the arrow should be behind the stuff below #}
        <div class="details-container">
            <div>{# tax section #}
                <p class="details-title">{% trans 'Tax' %}</p>
                <div class="tax-percent"></div>
                <div class="tax-absolute"></div>
            </div>

            <div>{# discounts section #}
                <p class="details-title">{% trans 'Discounts' %}</p>
                <ul class="discounts">
                    {# discounts that are already on the products will be added on the fly #}
                    <li class="select-existing">
                        <select>
                            {# existing and valid discounts #}
                        </select>
                        <button class="add-discount">+</button>
                    </li>
                    <li class="add-new">
                        {# just an input box and select for type of discount #}
                        <input type="text" class="description" placeholder="{% trans 'Description' %}" /><br />
                        <input type="text" class="amount" placeholder="{% trans 'Amount' %}"/>
                        <select class="type">
                            <option value="Percent">%</option>
                            <option value="Absolute">{{ currency }}</option>
                        </select>
                    </li>
                </ul>
            </div>

            <div>{# notes #}
                <p class="details-title">{% trans 'Notes' %}</p>
                <textarea class="notes"></textarea>
            </div>

            <div class="details-footer">
                <div class="buttons explode">
                    <button class="explode">{% trans 'Explode' %}</button>
                </div>

                <div class="buttons cancel">
                    <input type="button" value="{% trans 'Cancel' %}" class="cancel"/>
                </div>

                <div class="buttons ok">
                    <input type="button" value="{% trans 'Save' %}" class="ok"/>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="fullscreen shadow hidden" id="fullscreen_shadow"></div>

{% endblock %}

